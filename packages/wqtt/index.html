<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" href="data:,">
  <title>wqtt example</title>
</head>
<body>
  <div>
    <select id="protocol">
      <option>ws</option>
      <option>wss</option>
    </select>
    <input id="host" value="localhost">
    <input id="port" value="8080" type="number">
  </div>
  <div>
    <input id="username" value="" type="text" placeholder="username">
    <input id="password" value="" type="password" placeholder="password">
  </div>
  <div>
    <input id="keepAlive" value="45" type="number">
  </div>
  <div>
    <button onclick="connect()">connect</button>
    <button onclick="disconnect()">disconnect</button>
  </div>
  <br>
  <div>
    <input id="subscribeTopic" value="topic/name">
    <input id="subscribeQoS" value="0" type="number">
    <button onclick="subscribe()">subscribe</button>
    <button onclick="unsubscribe()">unsubscribe</button>
  </div>
  <br>
  <div>
    <input id="topic" value="topic/name">
    <input id="payload" value="payload">
    <input id="publishQoS" value="0" type="number">
    <button onclick="publish()">publish</button>
  </div>
  <br>
  <ul id="events">
  </ul>

<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0/polyfill.min.js"></script>
<script src="wqtt.js"></script>
<script>
let client = null;

function connect() {
  if (client) {
    client.disconnect();
  }

  client = new wqtt.Client({
    protocol: document.all.protocol.value,
    host: document.all.host.value,
    port: document.all.port.valueAsNumber,
    username: document.all.username.value,
    password: document.all.password.value,
    keepAlive: document.all.keepAlive.valueAsNumber,
    packetsend(packet) {
      logEvent('packetsend', JSON.stringify(packet));
    },
    packetreceive(packet) {
      logEvent('packetreceive', JSON.stringify(packet));
    },
    statechange(transition) {
      logEvent('statechange', `${transition.from} -> ${transition.to}`);
    },
  });

  client.connect();
}

function disconnect() {
  client.disconnect();

  client = null;
}

function subscribe() {
  client.subscribe(document.all.subscribeTopic.value, document.all.subscribeQoS.valueAsNumber);
}

function unsubscribe() {
  client.unsubscribe(document.all.subscribeTopic.value);
}

function publish() {
  client.publish(document.all.topic.value, document.all.payload.value, {
    qos: document.all.publishQoS.valueAsNumber,
  });
}

function logEvent(type, msg) {
  const li = document.createElement('li');
  li.textContent = `${type}: ${msg}`;
  document.all.events.appendChild(li);
}
</script>
</body>
</html>
