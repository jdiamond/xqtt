<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" href="data:,">
  <title>wqtt example</title>
</head>
<body>
  <div>
    <button onclick="connect()">connect</button>
    <button onclick="disconnect()">disconnect</button>
  </div>
  <div>
    <input id="topic" value="topic/name">
    <input id="payload" value="payload">
    <input id="publishQoS" value="0" type="number">
    <button onclick="publish()">publish</button>
  </div>
  <ul id="events">
  </ul>

<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0/polyfill.min.js"></script>
<script src="dist/wqtt.js"></script>
<script>
const client = new wqtt.Client({
  host: 'localhost',
  port: 8080,
  packetsend(packet) {
    logEvent('packetsend', JSON.stringify(packet));
  },
  packetreceive(packet) {
    logEvent('packetreceive', JSON.stringify(packet));
  },
  statechange(transition) {
    logEvent('statechange', `${transition.from} -> ${transition.to}`);
  },
});

function connect() {
  client.connect();
}

function disconnect() {
  client.disconnect();
}

function publish() {
  client.publish(document.all.topic.value, document.all.payload.value, {
    qos: document.all.publishQoS.value,
  });
}

function logEvent(type, msg) {
  const li = document.createElement('li');
  li.textContent = `${type}: ${msg}`;
  document.all.events.appendChild(li);
}
</script>
</body>
</html>
